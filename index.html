<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Chamber</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1DB954">
<style>
/* Spotify-style dark theme */
body { margin:0; font-family: Arial, sans-serif; background-color:#121212; color:#fff; }
header { padding:20px; font-size:2em; text-align:center; font-weight:bold; background-color:#1E1E1E; }
.search-container { display:flex; justify-content:center; padding:10px; }
input[type="text"] { width:50%; padding:10px; border-radius:5px; border:none; outline:none; font-size:1em; }
button { margin-left:10px; padding:10px 15px; border:none; border-radius:5px; background-color:#1DB954; color:#fff; cursor:pointer; font-weight:bold; }
.main { display:flex; flex-direction:column; align-items:center; padding:10px; }
.song-list { width:60%; margin-top:20px; }
.song { display:flex; justify-content:space-between; padding:10px; margin-bottom:5px; background-color:#282828; border-radius:5px; cursor:pointer; transition:0.2s; }
.song:hover { background-color:#383838; }
.player { position:fixed; bottom:0; width:100%; background-color:#181818; display:flex; justify-content:space-around; align-items:center; padding:10px; }
.player button { background:none; border:none; color:#1DB954; font-size:1.2em; cursor:pointer; }
iframe { width:100%; height:80px; border:none; border-radius:5px; }
.stats { margin:20px; text-align:center; }
</style>
</head>
<body>
<header>Music Chamber</header>

<div class="search-container">
<input type="text" id="searchInput" placeholder="Search for a song...">
<button onclick="searchSong()">Search</button>
</div>

<div class="main">
<div class="song-list" id="songList"></div>
<div id="playerContainer"></div>
<div class="stats" id="stats"></div>
</div>

<script>
const YT_API_KEY = 'AIzaSyCGIFGRXBMj9tfht-KksOlD04OWIgX0qHk';

let currentSongIndex=0;
let songs=[];
let shuffle=false;
let loop=false;
let loopOne=false;
let aiShuffle=false;

function searchSong(){
  const query=document.getElementById('searchInput').value;
  if(!query) return;
  fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=10&q=${encodeURIComponent(query)}&key=${YT_API_KEY}`)
  .then(res=>res.json())
  .then(data=>{
    songs=data.items.map(item=>({title:item.snippet.title, videoId:item.id.videoId}));
    displaySongs();
  });
}

function displaySongs(){
  const list=document.getElementById('songList');
  list.innerHTML='';
  songs.forEach((song,index)=>{
    const div=document.createElement('div');
    div.className='song';
    div.innerHTML=`<span>${song.title}</span><button onclick="playSong(${index})">‚ñ∂Ô∏è</button>`;
    list.appendChild(div);
  });
}

function playSong(index){
  currentSongIndex=index;
  const container=document.getElementById('playerContainer');
  container.innerHTML=`<iframe src="https://www.youtube.com/embed/${songs[index].videoId}?autoplay=1" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
  savePlayedSong(songs[index]);
}

function nextSong(){
  if(shuffle) currentSongIndex=Math.floor(Math.random()*songs.length);
  else { currentSongIndex++; if(currentSongIndex>=songs.length) currentSongIndex=0; }
  playSong(currentSongIndex);
}

function prevSong(){
  currentSongIndex--; if(currentSongIndex<0) currentSongIndex=songs.length-1;
  playSong(currentSongIndex);
}

function toggleShuffle(){ shuffle=!shuffle; alert('Shuffle: '+shuffle);}
function toggleLoop(){ loop=!loop; alert('Loop Playlist: '+loop);}
function toggleLoopOne(){ loopOne=!loopOne; alert('Loop One Song: '+loopOne);}
function toggleAIShuffle(){ aiShuffle=!aiShuffle; alert('AI Shuffle: '+aiShuffle);}

// === Offline caching storage for songs ===
let playedSongs = JSON.parse(localStorage.getItem('playedSongs')||'[]');
function savePlayedSong(song){ 
  if(!playedSongs.find(s=>s.videoId===song.videoId)) playedSongs.push(song); 
  localStorage.setItem('playedSongs',JSON.stringify(playedSongs));
}

// Display top played songs (basic stats)
function displayStats(){
  const statsDiv=document.getElementById('stats');
  statsDiv.innerHTML='<h3>Recently Played / Cached Songs:</h3>';
  playedSongs.forEach(song=>{
    const div=document.createElement('div');
    div.textContent=song.title;
    statsDiv.appendChild(div);
  });
}
displayStats();

// PWA service worker registration
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/sw.js').then(()=>console.log('Service Worker Registered'));
}
</script>

<div class="player">
<button onclick="prevSong()">‚èÆÔ∏è</button>
<button onclick="playSong(currentSongIndex)">‚èØÔ∏è</button>
<button onclick="nextSong()">‚è≠Ô∏è</button>
<button onclick="toggleShuffle()">üîÄ</button>
<button onclick="toggleLoop()">üîÅ</button>
<button onclick="toggleLoopOne()">üîÇ</button>
<button onclick="toggleAIShuffle()">ü§ñ</button>
</div>

</body>
</html>
